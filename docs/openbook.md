Solana DevnetにおけるRaydium統合のためのOpenBookマーケット作成に関する包括的コマンドラインガイド第1章: 基盤となる環境とツーリングこのセクションでは、ローカル開発環境の構築について詳述します。これは交渉の余地のない前提条件であり、後続のすべてのオンチェーン対話は、Solanaツールスイートの正しいインストールと設定に依存します。ここでは、CLIをDevnetクラスタと対話するように特別に設定し、この操作専用のキーペアを生成し、トランザクション手数料とオンチェーンアカウントのレント（賃料）を賄うためにDevnet SOLで資金を供給します。1.1. Devnet対話のためのSolana CLIの設定OpenBookマーケットを作成するための最初のステップは、Solanaネットワークとの主要なインターフェースとなるSolanaコマンドラインインターフェース（CLI）ツールスイートを確立することです 1。インストール後、すべての後続コマンドがDevnetクラスタに向けられるように設定する必要があります。Devnetは、現実の資産を使用しない安全なテスト環境です。以下のコマンドを実行して、RPCエンドポイントをDevnetに設定します。Bashsolana config set --url https://api.devnet.solana.com
この設定は、開発環境がメインネットではなくテスト用のネットワークを指していることを保証するために不可欠です 1。設定が正しく適用されたことを確認するために、次のコマンドを実行します。Bashsolana config get
出力には、RPC URLがDevnetのアドレスに設定されていることが示されるはずです。これにより、開発者の環境が後続のステップに進む前に正しくセットアップされていることが保証されます 2。1.2. キーペア生成とDevnet SOLのエアドロッププロトコル次に、Devnetでの操作に使用する一意のウォレット（アカウント）を作成します。これはキーペアを生成することによって行われます。メインネット用とDevnet用など、複数のアイデンティティを管理するために、キーペアを特定のファイルに保存することが推奨されます。Bashsolana-keygen new --outfile ~/.config/solana/devnet.json
このコマンドは、指定されたパスに新しいキーペアファイルを生成します 1。次に、この新しいキーペアをCLIのデフォルト署名者として設定します。Bashsolana config set --keypair ~/.config/solana/devnet.json
この設定により、トランザクションに署名する際に毎回キーペアファイルを指定する必要がなくなります 1。オンチェーンでアカウントを作成し、トランザクション手数料を支払うには、ウォレットに資金が必要です。Devnetでは、「エアドロップ」によってテスト用のSOLを無料で要求できます。Bashsolana airdrop 2
このコマンドは、デフォルトのキーペアに2 SOLを要求します。これは、マーケット作成に必要なレント（賃料）とトランザクション手数料を十分にカバーします 1。資金が正常に供給されたことを確認するために、残高を確認します。Bashsolana balance
1.3. 必須コマンドラインユーティリティのインストール: spl-token-cli と Rust/CargoSolanaエコシステムはモジュール式のアーキテクチャを採用しており、そのツール群も同様です。コアなネットワーク対話はsolana-cliが担いますが、SPLトークン規格に特化した操作には別のユーティリティが必要です。spl-token-cliは、SPLトークンの作成、ミント（鋳造）、管理を行うための不可欠なツールです。これはRustのパッケージマネージャーであるCargoを通じてインストールされます。まず、Rustツールチェーン（rustupとcargoを含む）をインストールします。これは、spl-token-cliだけでなく、後のセクションで使用するOpenBookマーケット作成ツール（これもRustベース）にも必要です 1。Bashcurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
インストール後、ターミナルを再起動するか、指示に従ってパスを設定してください。次に、Cargoを使用してspl-token-cliをインストールします。Bashcargo install spl-token-cli
このツールの分離は、Solanaの階層的な設計を反映しています。ベースレイヤーにはアカウントとSOLを扱うsolana-cli、その上にはSolana Program Library (SPL) とそのトークンプログラム用のCLI、そして最上位にはOpenBookのようなアプリケーション固有のプログラムとその対話スクリプトが存在します。この構造を理解することは、Solana dAppの構築とデバッグにおいて極めて重要です。第2章: オンチェーン資産の準備: ベースおよびクォートSPLトークンOpenBookマーケットは、本質的に2つの異なる資産間の取引ペアです 6。マーケットを作成する前に、これら2つの資産がSPLトークンとしてオンチェーンに存在している必要があります。このセクションでは、spl-token-cliを使用してこれらのトークンを作成するための綿密なステップバイステップガイドを提供します。取引対象となる「ベース」トークンと、価格設定に使用される「クォート」トークン（Devnetでは通常WSOLまたはUSDC）を作成します。2.1. spl-token create-tokenによるミントアカウントの生成トークン自体をオンチェーンで表現するためには、まず「ミントアカウント」を作成する必要があります。このアカウントは、トークンの総供給量やミント権限などのグローバルなプロパティを定義します 4。ベーストークンとクォートトークンのために、以下のコマンドを2回実行します。Bash# ベーストークンの作成 (例: 9ディシマル)
spl-token create-token --decimals 9

# クォートトークンの作成 (例: 6ディシマル、USDCなど)
spl-token create-token --decimals 6
このコマンドの出力には、新しく作成されたトークンのミントアドレス（公開鍵）が含まれます。このアドレスは後のステップで不可欠となるため、安全に記録しておく必要があります 1。2.2. トークンのディシマル（小数点以下の桁数）の重要な役割トークン作成時に最も重要なパラメータの一つが--decimalsフラグです。この値は、トークンの最小分割単位を決定します。例えば、6ディシマルのトークンは10−6（0.000001）単位まで分割可能です 4。このディシマルの値は、トークンの最大供給可能量と直接的かつ重大な関係があります。SolanaのSPLトークンプログラムでは、供給量は符号なし64ビット整数（u64）として格納されます。これは、最大値が264−1であることを意味します。したがって、ディシマルの値が高いと、表現可能な整数のトークン総数が大幅に制限されます 9。例えば、9ディシマルのトークン（SOLと同様）の最大供給量は約18.4×109（184億）トークンです。一方、Ethereumで一般的な18ディシマルを持つトークンをSolanaで作成した場合、その最大供給量はわずか約18.4トークンになってしまいます。これは他のエコシステムから来た開発者が陥りやすい罠であり、トークノミクスを設計する上で極めて重要な考慮事項です。2.3. 権限ウォレットのための関連トークンアカウント（ATA）の作成ミントアカウントはトークンを定義するだけです。そのトークンの残高を保持するためには、ウォレットに対応する「トークンアカウント」が必要です 4。新しく作成した2つのトークンそれぞれに対して、以下のコマンドを実行します。Bash# ベーストークンのトークンアカウントを作成
spl-token create-account <BASE_TOKEN_MINT_ADDRESS>

# クォートトークンのトークンアカウントを作成
spl-token create-account <QUOTE_TOKEN_MINT_ADDRESS>
このコマンドは、特定のウォレットとミントのペアに対して、標準的で決定論的なアドレスを持つ関連トークンアカウント（ATA）を作成します 11。これにより、開発者のウォレットが後でミントされるトークンを受け取ることが可能になります。2.4. テストおよび検証のための初期トークン供給のミントアカウントの準備が整ったので、spl-token mintコマンドを使用して初期供給量をミントします 1。指定する<AMOUNT>は、トークンの最小単位でなければならないことに注意が必要です。つまり、（希望するトークン量） * 10^（ディシマル数）で計算した値を指定する必要があります 12。Bash# ベーストークンを100万ミント (9ディシマルの場合)
spl-token mint <BASE_TOKEN_MINT_ADDRESS> 1000000000000

# クォートトークンを100万ミント (6ディシマルの場合)
spl-token mint <QUOTE_TOKEN_MINT_ADDRESS> 1000000000000
ミントプロセスが意図通りに実行されたことを確認するために、オンチェーンの状態を検証します。Bash# 総供給量の確認
spl-token supply <TOKEN_MINT_ADDRESS>

# ウォレットのトークン残高の確認
spl-token balance <TOKEN_MINT_ADDRESS>
これらのコマンドは、オンチェーンの状態が実行したアクションと一致していることを確認するための重要な検証ステップです 1。表2.1: 生成されたオンチェーン資産アドレスの概要このプロセスでは複数の公開鍵が生成され、それらは後続のコマンドの入力となります。これらのアドレスを構造化された形式で記録することは、コピー＆ペーストによるエラーを最小限に抑えるために不可欠です。資産の役割公開鍵アドレスディシマル数初期ミント供給量ベース・トークン・ミント(create-tokenの出力)91,000,000クォート・トークン・ミント(create-tokenの出力)61,000,000ベース・トークンATA(create-accountの出力)--クォート・トークンATA(create-accountの出力)--第3章: OpenBookマーケットのオンチェーンアーキテクチャこのセクションでは、資産の準備からマーケット自体の理解へと移行し、マーケット作成コマンドを理解するために必要な理論的基盤を提供します。OpenBookマーケットは単一のエンティティではなく、中央指値注文板（CLOB）モデル内でそれぞれ特定の機能を果たす、複数の異なるオンチェーンアカウントから構成される複合構造です 13。このアーキテクチャを理解することは、作成パラメータとその関連コストを把握する鍵となります。3.1. コアマーケットアカウントの分析: マーケット状態、リクエストキュー、イベントキュー、ビッド、アスクOpenBookマーケットは、連携して機能する5つの主要なアカウントタイプで構成されています。マーケット状態アカウント (Market State Account): これはマーケットの中央ハブとして機能し、他のすべての関連アカウントへの参照、ベースおよびクォートトークンのミントアドレス、そしてロットサイズやティックサイズといった精度パラメータなどのメタデータを保持します 13。リクエストキュー (Request Queue): 注文のマッチングエンジンによって処理される前の、未処理の注文発注およびキャンセル要求を保持する、比較的小さな固定サイズのアカウントです 13。イベントキュー (Event Queue): マッチングエンジンの出力（約定、キャンセルなどのアウトイベント）を記録する、はるかに大きなアカウントです。このキューは、「クランカー」と呼ばれる外部のアクターによって消費され、取引の決済やユーザー残高の更新が行われます 13。ビッドおよびアスクアカウント (Bids and Asks Accounts): これらは注文板そのものであり、それぞれ買い注文と売り注文のすべての未決済指値注文を格納するスラブデータ構造（crit-bitツリー）として構成されています 16。3.2. オンチェーン状態の経済学: アカウントサイズがレントとマーケット作成コストを決定する仕組みこれらの抽象的なアカウントの概念は、Solanaの具体的なアカウントモデルと密接に関連しています 17。Solana上のすべてのアカウントは、オンチェーンに存在し続けるために、格納するデータ量（バイト単位）に比例したレント（賃料）を支払う必要があります 20。OpenBookマーケットの作成に多額のコスト（約0.3から2.8 SOL）がかかるのは、プロトコル手数料によるものではなく、その大部分がこれらの大規模なアカウントをレント免除にするための一時的な支払いです 21。特にイベントキュー、ビッド、アスクのアカウントはサイズが大きく、時にはメガバイト単位に達するため、そのレントは相当な額になります 16。この点を理解することは、開発者がSOLの使途を把握し、なぜ次のセクションで説明する「高度な」パラメータがコストに劇的な影響を与えるのかを理解する上で極めて重要です。マーケット作成コストは、本質的にはオンチェーンに永続的なストレージを確保するための費用なのです。第4章: マーケット作成パラメータの詳細な分析このセクションは、本レポートの分析的な核心部分です。list-marketコマンドの引数を機能別に分類し、詳細に解説します。これにより、開発者は単にコマンドをコピーするだけでなく、低コストのDevnetテストから高性能なメインネットの立ち上げまで、特定のニーズに合わせてマーケットを設定するための知識を得ることができます。4.1. コアパラメータ: 取引ペアの定義マーケットの最も基本的な構成要素は、取引される2つのトークンです。--coin-mint <BASE_MINT_ADDRESS>: このパラメータは、ベーストークンのミントアカウントの公開鍵を指定します（第2章で作成）5。これは価格が付けられ、取引される資産です（例: MYTOKEN/USDCペアにおける「MYTOKEN」）25。--pc-mint <QUOTE_MINT_ADDRESS>: このパラメータは、クォートトークンのミントアカウントの公開鍵を指定します 5。これは価格設定に使用される通貨です（例: MYTOKEN/USDCペアにおける「USDC」）25。これらの値には、表2.1で記録したアドレスを使用します。4.2. 精度パラメータ: ロットサイズとティックサイズの詳細これらのパラメータは、マーケットの価格と数量の最小単位を定義し、取引の粒度を決定します。ロットサイズ (Lot Size / Min. Order Size): これは、取引可能なベーストークンの最小数量を定義します。すべての注文サイズは、このロットサイズの倍数でなければなりません 25。この値は、ベーストークンのディシマル数と概念的に関連しています。ティックサイズ (Tick Size / Min. Price Tick): これは、マーケットの最小価格変動単位を定義します。すべての注文価格は、このティックサイズの倍数でなければなりません 25。この値はクォートトークンの単位で測定されます。これら2つのパラメータの合計精度には、しばしば基盤となるトークンのディシマル数に関連する厳しい制約が存在します 27。例えば、Raydiumのドキュメントでは、マーケットはこれら2つのパラメータを合わせて6桁を超える小数点以下の桁数を持つことはできないとされています 27。精度が高すぎるなど、不適切な組み合わせは、マーケット作成時に「トランザクションシミュレーション失敗」エラーを引き起こす一般的な原因です 29。第2章で定義したトークンのディシマルに基づいて有効な値を選択するための計算式アプローチと具体例を提示することが、エラー回避の鍵となります。4.3. 高度な設定: キューとオーダーブックの長さがもたらすパフォーマンスとコストのトレードオフこれらのパラメータは、第3章で説明したオンチェーンアカウントのサイズ（エントリ数）を直接制御し、マーケットのパフォーマンスと作成コストのバランスを決定します 6。イベントキュー長 (Event Queue Length), リクエストキュー長 (Request Queue Length), オーダーブック長 (Orderbook Length): これらの値は、対応するオンチェーンアカウントに割り当てられるスペースの大きさを定義します。ここには、実用的なデプロイメントにおいて最も重要な因果関係が存在します。原因: キューやオーダーブックの長さを短く設定する。効果1（利点）: オンチェーンアカウントのバイトサイズが小さくなり、レント免除コストが劇的に低下します。これにより、コストを約2.8 SOLから約0.4 SOLまで削減することが可能です 23。効果2（欠点）: マーケットのスループットと容量が低下します。イベントキューが小さいと、トークンローンチのような高取引量時にキューが満杯になり、新たな約定が処理できなくなることで、事実上マーケットが停止する可能性があります 16。オーダーブックが小さいと、格納できる価格レベルの数が減り、マーケットの厚みが失われます 30。リクエストキューが小さいと、同時に処理できる注文発注の数が制限されます。このトレードオフは、「最小」設定がDevnetでのテストや低取引量のトークンには適しているものの、需要の高いメインネットでのローンチには壊滅的な結果をもたらす可能性があることを意味します 23。表4.1: Devnetテスト用のパラメータ設定シナリオこの表は、複雑なトレードオフの議論を、異なるテスト目標のための具体的でコピー＆ペースト可能な値に変換し、実用的なプリセットを提供します。シナリオ名イベントキュー長リクエストキュー長オーダーブック長推定SOLコストユースケース最小コスト12863201約 0.4 SOL基本的な機能テスト、低コストでのID取得 6中間パフォーマンス140063450約 1.5 SOL中程度の取引量を想定したテスト 31最適/高パフォーマンス297863909約 2.8 SOL高取引量のローンチシミュレーション 31第5章: マーケットインスタンス化のための決定的なコマンドライン手順このセクションでは、これまでのすべての情報を統合し、単一の実行可能なコマンドライン操作として提示します。コマンドの紛らわしい命名についても触れ、完全に注釈付きの例を提供します。5.1. openbook-dex CLIユーティリティのコンパイルと準備5のcargo run構文に基づくと、このユーティリティはopenbook-dexやそのフォークのような、より大きなRustプロジェクトの一部である可能性が高いです 32。関連するリポジトリ（例: https://github.com/openbook-dex/program.git）をクローンし、クライアントユーティリティを含むdexディレクトリに移動する必要があります 32。Bashgit clone https://github.com/openbook-dex/program.git
cd program/dex
次に、cargo buildコマンドを実行してユーティリティをコンパイルします。これにより、実行可能なバイナリが生成されます。5.2. マーケット作成コマンドのステップバイステップ実行一部のCLIバージョンでは、直感に反して、マーケットを作成するためのコマンドがlist-marketと名付けられているようです 5。この点を明確にすることは、ユーザーの混乱とフラストレーションを防ぐために不可欠です。以下に、マーケットを作成するための完全なコマンド構造を示します。これは、コンパイルされたバイナリを直接実行する形式です。Bash# program/dex ディレクトリから実行
./target/debug/spl-token-cli list-market \
    --cluster devnet \
    --payer <KEYPAIR_PATH> \
    --dex-program-id <DEX_PROGRAM_ID> \
    --coin-mint <BASE_MINT_ADDRESS> \
    --pc-mint <QUOTE_MINT_ADDRESS> \
    --lot-size <LOT_SIZE> \
    --tick-size <TICK_SIZE> \
    --event-queue-length <LENGTH> \
    --request-queue-length <LENGTH> \
    --orderbook-length <LENGTH>
各プレースホルダーは、以前のセクションで準備した値に置き換える必要があります。<KEYPAIR_PATH>: 第1章で生成したキーペアのパス（例: ~/.config/solana/devnet.json）。<DEX_PROGRAM_ID>: Devnet用のOpenBook DEXプログラムID EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj 34。<BASE_MINT_ADDRESS> と <QUOTE_MINT_ADDRESS>: 表2.1から取得したミントアドレス。<LOT_SIZE>, <TICK_SIZE>: 第4.2節で議論した精度パラメータ。<LENGTH> パラメータ: 表4.1から選択したキューとオーダーブックの長さ。5.3. コマンド出力の解析とマーケットIDの取得コマンドが正常に実行されると、ターミナルに複数のトランザクション署名とアカウントアドレスが出力されます。この中で最も重要な情報は、新しいマーケットIDです。出力は通常、Creating market... <MARKET_ID>のような形式で表示されます。このマーケットID（公開鍵）は、作成されたマーケットの主要な識別子であり、後にRaydiumで流動性プールを作成する際に必須の入力となります。このアドレスを安全にコピーし、保存することが極めて重要です 7。第6章: 作成後の検証とオンチェーン分析ターミナルでのトランザクション署名の成功は、必ずしも正しさを保証するものではありません。このセクションでは、ブロックエクスプローラーを使用して、マーケットが意図したパラメータで正常に作成されたことを確認する厳密な検証プロセスを概説します。これは、流動性を投入する前の重要な最終チェックです。6.1. Solana Explorerを使用したマーケットIDと関連アカウントの検査Solanaブロックエクスプローラー（例: Solscan, explorer.solana.com）を開き、新しく生成されたマーケットIDを検索します 7。マーケットアカウントのページには、それに関連するすべてのアカウント（イベントキュー、リクエストキュー、ビッド、アスクなど）が表示されます。これらのアカウントが作成され、正しいOpenBook DEXプログラムによって所有されていることを確認します 14。6.2. マーケットパラメータのオンチェーンでの確認エクスプローラー上でマーケットIDのデシリアライズされたアカウントデータを確認すると、ベースミント、クォートミント、ロットサイズ、ティックサイズなどのオンチェーンに保存された値が表示されます。これらの値が、コマンドで使用したパラメータと一致していることを相互参照し、作成中にエラーがなかったことを確認します。6.3. SPLトークンアカウントの最終状態検証最後の健全性チェックとして、使用したATA（関連トークンアカウント）に対して再度spl-token balanceを実行します。この時点ではまだ流動性は追加されていないため、残高は初期のミントステップから変更されていないはずです。これにより、予期しないトークンの移動がなかったことが確認されます。第7章: 結論とRaydium AMM統合への移行この最終セクションでは、プロセス全体を要約し、最も重要な点として、この手順全体をユーザーの本来の文脈であるRaydium AMMのデプロイ準備に結びつけます。7.1. コマンドラインによるマーケット作成プロセスの概要環境設定から始まり、資産作成、パラメータ定義、マーケット作成、そして最終的なオンチェーン検証に至るまで、エンドツーエンドのワークフローが概説されました。この手順に従うことで、開発者はコマンドラインから完全に制御された形でOpenBookマーケットをDevnet上にインスタンス化できます。7.2. 生成されたマーケットIDをRaydium流動性プール作成で使用するための戦略的推奨事項検証済みのOpenBookマーケットIDは、Raydiumで「レガシーAMMv4」プールを作成する際に必要な主要な入力情報です 27。RaydiumのUIまたはSDKを使用してプールを作成する際、このマーケットIDを提供することで、AMMはOpenBookのオーダーブックと流動性を共有できるようになります 37。しかし、専門的なレベルの回答を提供するためには、Raydiumのアーキテクチャの進化に言及することが不可欠です。Raydiumは、OpenBookマーケットIDを必要としない、より新しい「コンスタントプロダクトMM」（CPMM）プールタイプを導入しました 40。この新しい標準は、プール作成をより安価かつシンプルにします。この重要な情報は、開発者が情報に基づいた意思決定を行うことを可能にします。もし開発者の目標が単に流動性プールを作成することであり、RaydiumとOpenBookの直接的な統合が厳密な要件でない場合、より新しく効率的なCPMM標準を選択することが賢明かもしれません。この知見は、対象となるエコシステムの深く、最新の理解を示すものであり、単なる手順の解説を超えた価値を提供します。